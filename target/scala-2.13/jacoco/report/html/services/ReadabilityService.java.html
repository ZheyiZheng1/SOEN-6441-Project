<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReadabilityService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">services</a> &gt; <span class="el_source">ReadabilityService.java</span></div><h1>ReadabilityService.java</h1><pre class="source lang-java linenums">/**
 * @author: Zheyi Zheng - 40266266
 * Created: 2024/10/30
 * This is the ReadabilityService class. This class is for individual part (e).
 * This class take a CompletableFuture&lt;List&lt;YTResponse&gt;&gt; as an input, process it and calculate Flesch Reading Ease Score, Flesch-Kincaid Grade Level, and Average readability
 *
 */
package services;

import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.atomic.AtomicBoolean;
import java.util.stream.Collectors;
import java.util.stream.IntStream;

public class ReadabilityService {
    //Flesch Reading Ease Score
<span class="fc" id="L21">    List&lt;Double&gt; fre = new ArrayList&lt;&gt;();</span>
    //Flesch-Kincaid Grade Level
<span class="fc" id="L23">    List&lt;Double&gt; fkgl = new ArrayList&lt;&gt;();</span>

    Double avgFRE;
    Double avgFKGL;

    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * This is the Constructors method. This class method take a CompletableFuture&lt;List&lt;YTResponse&gt;&gt; and use thenApply to perform calculation.
     * Calculation inside thenApply are for fre and fkgl. All calculation and data processing are done by stream.
     * @param target should be the response of the YouTube
     */
    public ReadabilityService(CompletableFuture&lt;List&lt;YTResponse&gt;&gt; target){
<span class="fc" id="L36">        super();</span>
        // Process the input to get fre, fkgl and average readability
<span class="fc" id="L38">        target.thenAccept(list -&gt; {</span>
            List&lt;Double&gt; totalWords;
            List&lt;Double&gt; totalSentences;
            List&lt;Double&gt; totalSyl;

            // Use steam to count each description's total word number and collect as list of Integer. Assuming all words are separated by at least one whitespace.
            totalWords = list.stream()
                    .map(YTResponse::getDescription)
                    .map(sentence -&gt; (double) sentence.trim().split(&quot;\\s+&quot;).length)
                    .collect(Collectors.toList());

            // Use steam to count each description's total sentences number and collect as list of Integer. Assuming all sentences end with . or ! or ?.
            totalSentences = list.stream()
                    .map(YTResponse::getDescription)
                    .map(sentence -&gt; (double) sentence.trim().split(&quot;[.!?]+&quot;).length)
                    .collect(Collectors.toList());

            // Use steams to count each description's total syllable numbers. It first map to stream of String, then map to stream integers which each represent syllable number of that description.
            totalSyl = list.stream()
                    .map(YTResponse::getDescription)
                    .map(this::countSyllablesInDescription)
                    .map(Integer::doubleValue)
                    .collect(Collectors.toList());

            // Prepare the decimal format, this object round the result to 1 decimal place. Otherwise, it will not match with the result provided by the website.
            DecimalFormat df = new DecimalFormat(&quot;#.0&quot;);
            // Calculate FRE use provided formula. For each group of totalWords, totalSentences and totalSyl, perform the formula and add to the result list.
            IntStream.range(0, totalWords.size()).forEach(i -&gt; {
                // Calculate and round the fre to one decimal place.
                this.fre.add(Double.parseDouble(df.format(206.835 - 1.015 * (totalWords.get(i)/totalSentences.get(i)) - 84.6*(totalSyl.get(i)/totalWords.get(i)))));
            });
            // Calculate FKGL use provided formula. Same logic with fre.
            IntStream.range(0, totalWords.size()).forEach(i -&gt; {
                // Calculate and round the fkgl to one decimal place.
                this.fkgl.add(Double.parseDouble(df.format(0.39 * (totalWords.get(i)/totalSentences.get(i)) + 11.8*(totalSyl.get(i)/totalWords.get(i)) - 15.59)));
            });
        });
        // Calculate the average readability using stream. map to double, take average, orElse 0.0 in case of the list is empty.
<span class="fc" id="L76">        avgFRE = fre.stream().mapToDouble(Double::doubleValue).average().orElse(0.0);</span>
<span class="fc" id="L77">        avgFKGL = fkgl.stream().mapToDouble(Double::doubleValue).average().orElse(0.0);</span>

<span class="fc" id="L79">    }</span>

    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * This is the countSyllablesInDescription method.
     * This method use countSyllables to count all syllables in a description.
     * @param description, pass a description of a video.
     * @return an integer, represents number of syllables in provided description.
     *
     */
    private int countSyllablesInDescription(String description){
<span class="fc" id="L91">        return Arrays.stream(description.toLowerCase().split(&quot;\\s+&quot;))</span>
<span class="fc" id="L92">                .map(this::countSyllables)</span>
<span class="fc" id="L93">                .mapToInt(Integer::intValue)</span>
<span class="fc" id="L94">                .sum();</span>
    }

    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * This is the countSyllables method. This method just take a word and count Syllables
     * It returns an integer.
     * @param word in String.
     * @return an int that represents number of syllables in the word.
     */
    private int countSyllables(String word){
<span class="fc" id="L106">        AtomicBoolean prevWasVowel = new AtomicBoolean(false);</span>
<span class="fc" id="L107">        return (int) Arrays.stream(word.toLowerCase().split(&quot;&quot;))</span>
<span class="fc" id="L108">                .filter(c -&gt; {</span>
                    boolean isVowel = c.matches(&quot;[aeiou]&quot;);
                    // Continues syllables count as one. for example, io in description, ee in deep.
                    boolean countThis = isVowel &amp;&amp; !prevWasVowel.get();
                    prevWasVowel.set(isVowel);
                    return countThis;
                })
<span class="fc" id="L115">                .count();</span>
    }

    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * @return list of fre value
     */
    public List&lt;Double&gt; getFre() {
<span class="fc" id="L124">        return fre;</span>
    }
    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * @return list of fkgl value
     */
    public List&lt;Double&gt; getFkgl() {
<span class="fc" id="L132">        return fkgl;</span>
    }
    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * @return a double of average fre value
     */
    public Double getAvgFRE() {
<span class="fc" id="L140">        return avgFRE;</span>
    }
    /**
     * @author: Zheyi Zheng - 40266266
     * Created: 2024/10/30
     * @return a double of average fkgl value
     */
    public Double getAvgFKGL() {
<span class="fc" id="L148">        return avgFKGL;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>